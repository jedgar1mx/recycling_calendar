<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">

  <title>Waste Calendar</title>
  <meta name="description" content="Waste calendar is an application that will privide the citizens of the City of Detroit with information about their various waste pick up dates.">
  <meta name="author" content="Edgar Montes">
  <link href='assets/css/fullcalendar.min.css' rel='stylesheet' />
  <link href='assets/css/fullcalendar.print.min.css' rel='stylesheet' media='print' />
  <script src='assets/js/moment.min.js'></script>
  <script src='assets/js/jquery.min.js'></script>
  <script src='assets/js/fullcalendar.min.js'></script>
  <script src="assets/js/module.event.js"></script>
  <script>
    function getWeekNumber(d) {
      // Copy date so don't modify original
      d = new Date(+d);
      d.setHours(0,0,0);
      // Set to nearest Thursday: current date + 4 - current day number
      // Make Sunday's day number 7
      d.setDate(d.getDate() + 4 - (d.getDay()||7));
      // Get first day of year
      var yearStart = new Date(d.getFullYear(),0,1);
      // Calculate full weeks to nearest Thursday
      var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7)
      // Return array of year and week number
      return [d.getFullYear(), weekNo];
    }

    function weeksInYear(year) {
      var month = 11, day = 31, week;

      // Find week that 31 Dec is in. If is first week, reduce date until
      // get previous week.
      do {
        d = new Date(year, month, day--);
        week = getWeekNumber(d)[1];
      } while (week == 1);

      return week;
    }

    var addEventToList = function addeEventToList(year,weaks,eventType,eventInfo) {
      let title = eventType + ' pick up';
      let eventObj = {
        title : title,
        start : ''
      };
      switch (eventType) {
        case 'Garbage':
            eventObj.rendering = 'background';
          break;

        case 'Recycle':
            eventObj.color = '#068A24';
          break;

        case 'Bulk':
            eventObj.color = '#114BC7';
          break;
        default:

      }
      console.log(eventObj);
      // Add garbage pickup day every week
      for (var i = 1; i < weeks; i++) {
        let eventDate = moment().year(year).week(i).day(dummyObj.trash.dayOfWeek).format("YYYY-MM-DD");
        eventObj.start = eventDate;
        console.log(eventObj);
        if(eventInfo.schedule === 'weekly'){
          events.push(eventObj);
        }else{
          if(eventInfo.AorB === 'a'){
            ((i % 2) != 0) ? events.push(eventObj): 0;
          }else{
            ((i % 2) == 0) ? events.push(eventObj): 0;
          }
        }
      }
      console.log(events);
    }

    // var addRecycleEventToList = function addRecycleEventToList(year,weaks) {
    //   // Add recycle pickup day every other week
    //   for (var i = 1; i < weeks; i++) {
    //     let eventDate = moment().year(year).week(i).day(dummyObj.trash.dayOfWeek).format("YYYY-MM-DD");
    //     let eventObj = {
    //       title : 'Recycle Pick up',
    //       start : eventDate,
    // 			color: '#068A24'
    //     };
    //     if(dummyArray[2] === 'a'){
    //       ((i % 2) != 0) ? events.push(eventObj): 0;
    //     }else{
    //       ((i % 2) == 0) ? events.push(eventObj): 0;
    //     }
    //   }
    // }

    var events = [];
  	var dummyObj = {
      "trash": {
        "dayOfWeek": "friday",
        "schedule": "weekly",
        "AorB": null,
        "startDate": null,
        "endDate": null
      },
      "recycling": {
        "dayOfWeek": "thursday",
        "schedule": "biweekly",
        "AorB": "a",
        "startDate": null,
        "endDate": null
      },
      "yardWaste": {
        "dayOfWeek": "thursday",
        "schedule": "biweekly",
        "AorB": "a",
        "startDate": "2017-04-06T00:00:00.000Z",
        "endDate": "2017-12-07T00:00:00.000Z"
      }
    };
    var year = moment().year();
    var weeks = weeksInYear(year) + 1;

    addEventToList(year,weeks,'Garbage',dummyObj.trash);
    addEventToList(year,weeks,'Recycle',dummyObj.recycling);

  	var today = moment().format();
  	var events2 = [
  		{
  			title: 'Business Lunch',
  			start: '2016-12-03T13:00:00',
  			constraint: 'businessHours',
  			color: '#DC6B2A'
  		},
  		{
  			title: 'Garbage pick up',
  			start: '2016-12-13T11:00:00',
  			constraint: 'availableForMeeting', // defined below
  			color: '#DC6B2A'
  		},
  		{
  			title: 'Conference',
  			start: '2016-12-18',
  			end: '2016-12-20'
  		},
  		{
  			title: 'Party',
  			start: '2016-12-29',
        rendering: 'background',
  			color: '#DC6B2A'
  		},

  		// areas where "Meeting" must be dropped
  		{
  			id: 'availableForMeeting',
  			start: '2016-12-11T10:00:00',
  			end: '2016-12-11T16:00:00',
  			rendering: 'background'
  		},
  		{
  			id: 'availableForMeeting',
  			start: '2016-12-13T10:00:00',
  			end: '2016-12-13T16:00:00',
  			rendering: 'background'
  		},

  		// red areas where no events can be dropped
  		{
  			start: '2016-12-24',
  			end: '2016-12-28',
  			overlap: false,
  			rendering: 'background',
  			color: '#DC6B2A'
  		},
  		{
  			start: '2016-12-06',
  			end: '2016-12-08',
  			overlap: false,
  			rendering: 'background',
  			color: '#DC6B2A'
  		}
  	];
  	$(document).ready(function() {
  		$('#calendar').fullCalendar({
  			header: {
  				left: 'prev,next',
  				center: 'title',
  				right: 'month'
  			},
  			defaultDate: today,
  			navLinks: true, // can click day/week names to navigate views
  			// businessHours: true, // display business hours
  			editable: true,
  			events: events
  		});

  	});

  </script>
  <style>
    @import url('https://fonts.googleapis.com/css?family=Open+Sans');
  	body {
  		margin: 40px 10px;
  		padding: 0;
  		font-family: 'Open Sans', sans-serif;
  		font-size: 14px;
  	}

  	#calendar {
  		max-width: 900px;
  		margin: 0 auto;
  	}

    #leyend{
      display: flex;
      width: 100%;
      justify-content: center;
    }
    #leyend > article{
      font-weight: bold;
      padding: 2em 1em;
    }
    #leyend > article:first-child > span:first-child{
      width: 1em;
      height: 1em;
      background-color: #FA4F2E;
      color: #FA4F2E;
    }
    #leyend > article:nth-child(2) > span:first-child{
      width: 1em;
      height: 1em;
      background-color: #068A24;
      color: #068A24;
    }
    #leyend > article:nth-child(3) > span:first-child{
      width: 1em;
      height: 1em;
      background-color: #114BC7;
      color: #114BC7;
    }
  </style>
</head>
<body>
	<section id='calendar'></section>
  <section id='leyend'>
    <article>
      <span>ssss</span> Garbage pick up
    </article>
    <article>
      <span>ssss</span> Recycle pick up
    </article>
    <article>
      <span>ssss</span> Bulk pick up
    </article>
  </section>
</body>
</html>
